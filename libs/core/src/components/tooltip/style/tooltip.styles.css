@layer gds-tooltip, tokens, a11y, parts, position, animation;

/* 
TODO:
https://developer.chrome.com/blog/tether-elements-to-each-other-with-css-anchor-positioning/
*/

@layer gds-tooltip {
  @layer tokens {
    :host {
      --gds-tooltip-bg-color: #000;
      --gds-tooltip-bg-alpha: 90%;
      --gds-tooltip-bg: color-mix(
        in srgb,
        var(--gds-tooltip-bg-color) var(--gds-tooltip-bg-alpha),
        transparent
      );
      --gds-tooltip-color: #fff;
      --gds-tooltip-offset: 4px;
      --gds-tooltip-arrow: 6px;
      --gds-tooltip-radii: 20px;
      --gds-tooltip-transition-easing: var(--gds-sys-transition-easing);
      display: contents;
    }

    @media (prefers-color-scheme: dark) {
      :host {
        --gds-tooltip-color-bg: var(
          --gds-tooltip-color-bg-dark,
          var(--gds-color-grey-20)
        );
      }
    }
  }

  .gds-tooltip {
    display: inline-block;
    position: relative;

    @layer a11y {
      cursor: help;
      --gds-tooltip-transition: var(--gds-sys-transition);
      --gds-tooltip-contrast: var(--gds-sys-transition);
    }
  }

  @layer parts {
    ::before,
    ::after {
      font-size: 14px;
      line-height: 1;
      user-select: none;
      pointer-events: none;
      position: absolute;
      display: none;
      opacity: 0;
      align-items: center;
      justify-content: center;
    }

    ::before {
      content: '';
      border: var(--gds-tooltip-arrow, 6px) solid transparent;
      z-index: 1001;
      display: none !important;
    }

    ::after {
      content: attr(content);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      padding-inline: 2ch;
      padding-block: 1.5ex;
      max-inline-size: 50ch;
      min-inline-size: max-content;
      /* border-radius: 100px; */
      z-index: 1000;
      offset-anchor: center top;
      background-color: var(--gds-tooltip-bg);
      color: var(--gds-tooltip-color);
      border-radius: var(--gds-tooltip-radii);
      backdrop-filter: blur(40px);
      clip-path: polygon(
        0 0,
        100% 0,
        100% calc(100% - var(--gds-tooltip-arrow)),
        calc(50% + var(--gds-tooltip-arrow))
          calc(100% - var(--gds-tooltip-arrow)),
        50% 100%,
        calc(50% - var(--gds-tooltip-arrow))
          calc(100% - var(--gds-tooltip-arrow)),
        0 calc(100% - var(--gds-tooltip-arrow))
      );
    }

    :hover::before,
    :hover::after {
      display: flex;
    }
  }

  @layer position {
    .gds-tooltip:not([position])::before,
    .gds-tooltip[position^='up']::before {
      bottom: 100%;
      border-bottom-width: 0;
      border-top-color: var(--gds-tooltip-bg);
    }
    .gds-tooltip:not([position])::after,
    .gds-tooltip[position^='up']::after {
      bottom: calc(100% + var(--gds-tooltip-offset, 8px));
    }

    .gds-tooltip:not([position])::before,
    .gds-tooltip:not([position])::after,
    .gds-tooltip[position^='up']::before,
    .gds-tooltip[position^='up']::after {
      left: 50%;
      transform: translate(-50%, calc(var(--gds-tooltip-offset, 8px) * -1));
    }

    .gds-tooltip[position^='down']::before {
      top: 100%;
      border-top-width: 0;
      border-bottom-color: var(--gds-tooltip-bg);
    }
    .gds-tooltip[position^='down']::after {
      top: calc(100% + var(--gds-tooltip-offset, 8px));
    }
    .gds-tooltip[position^='down']::before,
    .gds-tooltip[position^='down']::after {
      left: 50%;
      transform: translate(-50%, var(--gds-tooltip-offset, 8px));
    }

    .gds-tooltip[position^='left']::before {
      top: 50%;
      border-right-width: 0;
      border-left-color: var(--gds-tooltip-bg);
      left: calc(-1px - var(--gds-tooltip-offset, 8px));
      transform: translate(calc(var(--gds-tooltip-offset, 8px) * -2), -50%);
    }
    .gds-tooltip[position^='left']::after {
      top: 50%;
      right: calc(100% + var(--gds-tooltip-offset, 8px));
      transform: translate(calc(var(--gds-tooltip-offset, 8px) * -1), -50%);
    }

    .gds-tooltip[position^='right']::before {
      top: 50%;
      border-left-width: 0;
      border-right-color: var(--gds-tooltip-bg);
      right: calc(-1px - var(--gds-tooltip-offset, 8px));
      transform: translate(var(--gds-tooltip-offset, 8px), -50%);
    }
    .gds-tooltip[position^='right']::after {
      top: 50%;
      left: calc(100% + var(--gds-tooltip-offset, 8px));
      transform: translate(var(--gds-tooltip-offset, 8px), -50%);
    }
  }

  @layer animation {
    @keyframes gds-tooltip-animation-y {
      to {
        opacity: 0.9;
        transform: translate(-50%, 0);
      }
    }

    @keyframes gds-tooltip-animation-h {
      to {
        opacity: 0.9;
        transform: translate(0, -50%);
      }
    }

    .gds-tooltip:not([position]):hover::before,
    .gds-tooltip:not([position]):hover::after,
    .gds-tooltip[position^='up']:hover::before,
    .gds-tooltip[position^='up']:hover::after,
    .gds-tooltip[position^='down']:hover::before,
    .gds-tooltip[position^='down']:hover::after {
      animation: gds-tooltip-animation-y 300ms
        var(--gds-tooltip-transition-easing) forwards;
    }

    .gds-tooltip[position^='left']:hover::before,
    .gds-tooltip[position^='left']:hover::after,
    .gds-tooltip[position^='right']:hover::before,
    .gds-tooltip[position^='right']:hover::after {
      animation: gds-tooltip-animation-h 300ms
        var(--gds-tooltip-transition-easing) forwards;
    }
  }
}
